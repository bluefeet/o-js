// o.js : DEVELOPMENT VERSION : https://o-js.com : MIT License
(function(){"use strict";var a=this,b=a.o,c={},d=c.clearer=function(a){return function(){delete this[a]}},e=c.getPrototypeOf=function(a){return Object.getPrototypeOf?Object.getPrototypeOf(a):Object.__proto__},f=c.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},g=c.local=function(a,b,c){var d,e=f(a,b),g=a[b];try{d=c()}finally{e?a[b]=g:delete a[b]}return d},h=c.merge=function(){for(var a=Array.prototype.slice.call(arguments),b=a.shift();a.length;){var c=a.shift();for(var d in c)f(c,d)&&(b[d]=c[d])}return b},i=c.predicate=function(a){return function(){return f(this,a)&&void 0!==this[a]}},j=(c.proxy=function(a,b){return function(){return this[a][b].apply(this[a],arguments)}},c.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.slice(1)}),k=c.writer=function(a,b){return b=b||{},b.augments&&(b.type=b.type||"object"),function(c){if(b.filter&&(c=b.filter.call(this,c)),b.type)if("string"==typeof b.type||b.type instanceof String){if(typeof c!==b.type)throw new Error(c+" failed validation.")}else if(b.type instanceof Function){if(!b.type(c))throw new Error(c+" failed validation.")}else b.type.coerce instanceof Function&&b.type.validate instanceof Function&&(b.coerce?c=b.type.coerce(c):b.type.validate(c));if(b.augments&&!(c instanceof b.augments))throw new Error(c+" failed validation.");var d=this[a];return this[a]=c,b.chain?this:d}},l=c.after=function(a,b){return function(){var c=a.apply(this,arguments);return b.call(this),c}},m=c.around=function(a,b){return function(){var c=this,d=Array.prototype.slice.call(arguments),e=function(){return a.apply(c,arguments)};return d.unshift(e),b.apply(c,d)}},n=c.before=function(a,b){return function(){return b.call(this),a.apply(this,arguments)}},o=c.clone=function(a){var b=Object.create(e(a));return b.constructor=a.constructor,h(b,a),b},p=c.construct=function(a,b){return h(a.prototype,b),a},q=c.reader=function(a,b){return b=b||{},b.writer=b.writer||k(a,b),b.predicate=b.predicate||i(a),function(){if(!b.predicate.call(this)){if(b.required)throw new Error(a+" is required.");if(b.devoid){var c=b.devoid;c instanceof Function&&(c=c.call(this)),b.writer.call(this,c)}else b.builder&&b.writer.call(this,this[b.builder].call(this))}return this[a]}};c.Type=p(function(a){a=a||{},"function"==typeof a&&(a={validate:a}),a.validate&&(this._validateMethod=a.validate),a.coerce&&(this._coerceMethod=a.coerce),a.parent&&(this._parent=a.parent)},{check:function(a){return c.Type.validationDisabled?!0:this._parent&&!this._parent.check(a)?!1:this._validateMethod?this._validateMethod(a)?!0:!1:!0},validate:function(a){if(!this.check(a))throw new Error(a+" failed validation.")},coerce:function(a){return a=this.coerceOnly(a),this.validate(a),a},coerceOnly:function(a){return this._parent&&(a=this._parent.coerceOnly(a)),this._coerceMethod&&(a=this._coerceMethod(a)),a},subtype:function(a){return"function"==typeof a&&(a={validate:a}),new c.Type(h({parent:this},a))}}),c.Type.validationDisabled=!1;var r=c.Type,s=c.accessor=function(a,b){return b=b||{},b.writer=b.writer||k(a,b),b.reader=b.reader||q(a,b),function(a){return void 0!==a?b.writer.call(this,a):b.reader.call(this)}},t=c.augment=function(a,b,c){var d=m(a,b);return childProto=Object.create(a.prototype),c&&h(childProto,c),d.prototype=childProto,d},u=(c.disableTypeValidation=function(a){return a?g(r,"validationDisabled",function(){return r.validationDisabled=!0,a()}):void(r.validationDisabled=!0)},c.AllType=t(r,function(a,b,c){c=c||{},c.validate=function(a){for(var c=0,d=b.length;d>c;c++)if(!b[c].check(a))return!1;return!0},a(c)})),v=c.AnyType=t(r,function(a,b,c){c=c||{},c.validate=function(a){for(var c=0,d=b.length;d>c;c++)if(b[c].check(a))return!0;return!1},a(c)}),w=c.EnumType=t(r,function(a,b,c){c=c||{},c.validate=function(a){for(var c=0,d=b.length;d>c;c++)if(a===b[c])return!0;return!1},a(c)}),x=c.EqualType=t(r,function(a,b,c){c=c||{},c.validate=function(a){return a===b?!0:!1},a(c)}),y=c.InstanceOfType=t(r,function(a,b,c){c=c||{},c.validate=function(a){return a instanceof b?!0:!1},c.coerce=function(a){return this.check(a)?a:new b(a)},a(c)}),z=c.LazyType=t(r,function(a,b,c){c=c||{};var d;c.validate=function(a){return d=d||b(),d.check(a)},c.coerce=function(a){return d=d||b(),d.coerce(a)},a(c)}),A=c.NoneType=t(r,function(a,b,c){c=c||{};var d=new v(b);c.validate=function(a){return d.check(a)?!1:!0},a(c)}),B=c.NotType=t(A,function(a,b,c){a([b],c)}),C=c.TypeOfType=t(r,function(a,b,c){c=c||{},c.validate=function(a){return typeof a===b?!0:!1},a(c)}),D=c.arrayType=new y(Array),E=c.booleanType=new v([new C("boolean"),new y(Boolean)]),F=(c.dateType=new y(Date),c.functionType=new y(Function)),G=c.nullType=new x(null),H=c.numberType=new v([new C("number"),new y(Number)]),I=c.objectType=new y(Object),J=c.positiveType=H.subtype(function(a){return a>0?!0:!1}),K=(c.regExpType=new y(RegExp),c.simpleObjectType=I.subtype(function(a){return a.constructor===Object?!0:!1})),L=c.stringType=new v([new C("string"),new y(String)]),M=c.typeType=new y(r),N=c.undefinedType=new x(void 0),O=c.ArrayOfType=t(r,function(a,b,c){c=c||{},c.validate=function(a){if(!D.check(a))return!1;for(var c=0,d=a.length;d>c;c++)if(!b.check(a[c]))return!1;return!0},c.coerce=function(a){if(!this.check(a))return a;for(var c=0,d=a.length;d>c;c++)a[c]=b.coerce(a[c]);return a},a(c)}),P=c.DuckType=t(r,function(a,b,c){c=c||{},c.validate=function(a){if(!I.check(a))return!1;if(D.check(b)){for(var c=0,d=b.length;d>c;c++)if(void 0===a[b[c]])return!1;return!0}if(K.check(b)){for(var e in b){if(void 0===a[e])return!1;if(!b[e].check(a[e]))return!1}return!0}return!1},a(c)}),Q=c.ObjectOfType=t(r,function(a,b,c){c=c||{},c.validate=function(a){if(!I.check(a))return!1;for(var c in a)if(!b.check(a[c]))return!1;return!0},c.coerce=function(a){if(!this.check(a))return a;for(var c in a)a[c]=b.coerce(a[c]);return a},a(c)}),R=c.PatternType=t(r,function(a,b,c){c=c||{},c.validate=function(a){return L.check(a)?b.test(a):!1},a(c)}),S=(c.TupleType=t(r,function(a,b,c){c=c||{},c.validate=function(a){if(!D.check(a))return!1;if(a.length!=b.length)return!1;for(var c in a){if(!b[c])return!1;if(!b[c].check(a[c]))return!1}return!0},c.coerce=function(a){if(!this.check(a))return a;for(var c in a)b[c]&&(a[c]=b[c].coerce(a[c]));return a},a(c)}),c.definedType=new B(N)),T=c.identifierType=new R(/^[A-Za-z_$][A-Za-z_$0-9]*$/),U=c.integerType=H.subtype(function(a){return Math.floor(a)===a+0?!0:!1}),V=(c.negativeType=H.subtype(function(a){return 0>a?!0:!1}),c.nonEmptyStringType=L.subtype(function(a){return a.length>0?!0:!1}),c.nonZeroType=H.subtype(function(a){return 0!==a?!0:!1}),c.positiveIntType=new u([U,J]),new v([E,T])),W=new z(function(){return new y(c.Trait)}),X=new z(function(){return new O(W)}),Y={key:{type:T,required:!0},argKey:{type:new v([T,G]),devoid:function(){return this.key()}},valueKey:{type:T,devoid:function(){return"_"+this.key()}},is:{type:W,filter:function(a){return W.check(a)?a:c[a+"AttributeTrait"]}},traits:{type:X,devoid:function(){return[]}},devoid:{type:S},builder:{type:V,filter:function(a){return a===!0&&(a="build"+j(this.key())),a}},required:{type:E},type:{type:new v([new w(["undefined","object","boolean","number","string","function"]),M,F])},coerce:{type:E},filter:{type:F},augments:{type:F},chain:{type:E},reader:{type:V,devoid:!0,filter:function(a){return a===!0&&(a=this.key()),a}},writer:{type:V,filter:function(a){return a===!0&&(a=this.key()),a}},predicate:{type:V,filter:function(a){return a===!0&&(a="has"+j(this.key())),a}},clearer:{type:V,filter:function(a){return a===!0&&(a="clear"+j(this.key())),a}},proxies:{type:new Q(T)}},Z={},$={};for(var _ in Y)Z[_]=k("_"+_,Y[_]),$[_]=q("_"+_,h({writer:Z[_]},Y[_]));var aa,ba=c.Attribute=p(function(a){a=a||{},this._originalArgs=o(a);var b={};Z.key.call(this,a.key),b.key=!0;for(var c in a)Z[c]&&(Z[c].call(this,a[c]),b[c]=!0);var d=this.is();d&&d.install(this,a,b);for(var e=this.traits(),f=0,g=e.length;g>f;f++)e[f].install(this,a,b)},h({readerMethod:q("_readerMethod",{type:F,devoid:function(){return q(this.valueKey(),{devoid:this.devoid(),builder:this.builder(),required:this.required(),writer:this.writerMethod(),predicate:this.predicateMethod()})}}),writerMethod:q("_writerMethod",{type:F,devoid:function(){return k(this.valueKey(),{type:this.type(),coerce:this.coerce(),filter:this.filter(),augments:this.augments(),chain:this.chain()})}}),accessorMethod:q("_accessorMethod",{type:F,devoid:function(){return s(this.valueKey(),{writer:this.writerMethod(),reader:this.readerMethod()})}}),predicateMethod:q("_predicateMethod",{type:F,devoid:function(){return i(this.valueKey())}}),clearerMethod:q("_clearerMethod",{type:F,devoid:function(){return d(this.valueKey())}}),proxyMethods:q("_proxyMethods",{type:new Q(F),devoid:function(){var a={},b=this.proxies();if(void 0===b)return a;var c=this;for(var d in b)a[d]=function(a){return function(){var b=c.getValue(this);return b[a].apply(b,arguments)}}(b[d]);return a}}),getValue:function(a){return this.readerMethod().call(a)},setValue:function(a,b){return this.writerMethod().call(a,b)},hasValue:function(a){return this.predicateMethod().call(a)},clearValue:function(a){return this.clearerMethod().call(a)},setValueFromArgs:function(a,b,c){var d=this.argKey();if(d&&void 0!==b[d])return c&&(c[d]=!0),this.setValue(a,b[d])},install:function(a,b){this.writer()&&this.writer()===this.reader()?a[this.writer()]=this.accessorMethod():(this.writer()&&(a[this.writer()]=this.writerMethod()),this.reader()&&(a[this.reader()]=this.readerMethod())),this.predicate()&&(a[this.predicate()]=this.predicateMethod()),this.clearer()&&(a[this.clearer()]=this.clearerMethod());var c=this.proxyMethods();for(var d in c)a[d]=c[d];return b&&this.setValue(a,b),a},rebuild:function(a){var b=this.constructor;return new b(h({},this._originalArgs,a))}},$)),ca=c.attributeType=new y(ba);c.Trait=p(function(a){"function"==typeof a&&(a=this.functionToArgs(a)),a=a||{};for(var b={},c=0,d=aa.length;d>c;c++)if(aa[c].setValueFromArgs(this,a,b),"is"==aa[c].key()){var e=this.is();e&&e.install(this,a,b)}},{functionToArgs:function(a){var b={requires:[],traits:[],attributeTraits:[],attributes:{},methods:{},around:{},before:{},after:{}},c={require:function(a){b.requires.push(a)},is:function(a){b.is=a},trait:function(a){b.traits.push(a)},attributesAre:function(a){b.attributesAre=a},attributeTrait:function(a){b.attributeTraits.push(a)},attribute:function(a,c){b.attributes[a]=c},method:function(a,c){b.methods[a]=c},around:function(a,c){b.around[a]=c},before:function(a,c){b.before[a]=c},after:function(a,c){b.after[a]=c}};return a.apply(c),b},install:function(a,b,c){var d,e,f,g=this.requires();g&&g.validate(a);var h=this.methods();for(f in h)a[f]=h[f];var i=this.traits();for(d=0,e=i.length;e>d;d++)i[d].install(a);var j=this.attributes();for(f in j)j[f].install(a);var k=this.around();for(f in k)a[f]=m(a[f],k[f]);var o=this.before();for(f in o)a[f]=n(a[f],o[f]);var p=this.after();for(f in p)a[f]=l(a[f],p[f]);return b&&this.setFromArgs(a,b,c),a},setFromArgs:function(a,b,c){var d=this.attributes();c||(c={});var e,f,g;for(g in d)d[g].filter()||d[g].setValueFromArgs(a,b,c);for(g in d)d[g].filter()&&d[g].setValueFromArgs(a,b,c);var h=this.traits();for(e=0,f=h.length;f>e;e++)h[e].setFromArgs(a,b,c)},buildType:function(){var a,b={},c=this.attributes();for(a in c){var d=c[a];d.reader()&&(b[d.reader()]=F),d.writer()&&(b[d.writer()]=F),d.predicate()&&(b[d.predicate()]=F),d.clearer()&&(b[d.clearer()]=F)}for(a in this.methods())b[a]=F;var e=/^_/m;for(a in b)a.match(e)&&delete b[a];b=new P(b);var f=this.traits();if(!f.length)return b;for(var g=[b],h=0,i=f.length;i>h;h++)g.push(f[h].type());return new u(g)}});var da=new y(c.Trait),ea=new O(da);aa=[{key:"requires",type:new y(P),coerce:!0},{key:"is",type:da,filter:function(a){return da.check(a)?a:c[a+"ClassTrait"]}},{key:"traits",type:ea,devoid:function(){return[]}},{key:"attributesAre",type:da,filter:function(a){return da.check(a)?a:c[a+"AttributeTrait"]}},{key:"attributeTraits",type:ea,devoid:function(){return[]}},{key:"attributes",type:new Q(ca),devoid:function(){return{}},filter:function(a){var b={};for(var c in a){var d=a[c];if(ca.check(d))d.key()!==c&&(d=d.rebuild({key:c}));else{var e={key:c,traits:this.attributeTraits()};this.attributesAre()&&(e.is=this.attributesAre()),d=new ba(h({},d,e))}b[c]=d}return b}},{key:"methods",type:new Q(F),devoid:function(){return{}}},{key:"around",type:new Q(F),devoid:function(){return{}}},{key:"before",type:new Q(F),devoid:function(){return{}}},{key:"after",type:new Q(F),devoid:function(){return{}}},{key:"type",type:M,builder:!0,argKey:null}];for(var fa=c.Trait.prototype,ga=0,ha=aa.length;ha>ga;ga++)aa[ga]=new ba(aa[ga]),aa[ga].install(fa);var ia=c.Trait,ja=c.liteAttributeTrait=new ia({methods:{valueKey:function(){return this.key()},reader:function(){return!1},writer:function(){return!1}}}),ka=(c.liteClassTrait=new ia({methods:{attributesAre:function(){return ja}}}),c.rwAttributeTrait=new ia({methods:{writer:function(){return this.key()}}}),c.rwpAttributeTrait=new ia({methods:{writer:function(){return"_set"+j(this.key())}}}),c.traitType=new y(ia)),la=c.classTrait=new ia({attributes:{type:{type:M,builder:!0,argKey:null},trait:{type:ka,required:!0}},methods:{buildType:function(){return new y(this)}}}),ma=c.Class=p(function(a){var b=new ia(a),c=function(a){a=a||{},b.setFromArgs(this,a)};return b.install(c.prototype),la.install(c,{trait:b}),c});c.classType=la.type().subtype({coerce:function(a){return this.check(a)?a:new ma(a)}});a.o=c,a.oJS=c,c.noConflict=function(){return a.o=b,c}}).call(this);