// o.js : DEVELOPMENT VERSION : https://o-js.com : MIT License
(function(){var a=this,b=a.o,c={},d=c.clearer=function(a){return function(){delete this[a]}},e=c.getPrototypeOf=function(a){return Object.getPrototypeOf?Object.getPrototypeOf(a):Object.__proto__},f=c.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},g=c.local=function(a,b,c){var d,e=f(a,b),g=a[b];try{d=c()}finally{e?a[b]=g:delete a[b]}return d},h=c.merge=function(){for(var a=Array.prototype.slice.call(arguments),b=a.shift();a.length;){var c=a.shift();for(var d in c)f(c,d)&&(b[d]=c[d])}return b},i=c.predicate=function(a){return function(){return f(this,a)&&void 0!==this[a]}},j=(c.proxy=function(a,b){return function(){return this[a][b].apply(this[a],arguments)}},c.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.slice(1)}),k=c.writer=function(a,b){return b=b||{},b.augments&&(b.type=b.type||"object"),function(c){if(b.filter&&(c=b.filter.call(this,c)),b.type)if("string"==typeof b.type||b.type instanceof String){if(typeof c!==b.type)throw new Error(c+" failed validation.")}else if(b.type instanceof Function){if(!b.type(c))throw new Error(c+" failed validation.")}else b.type.coerce instanceof Function&&b.type.validate instanceof Function&&(b.coerce?c=b.type.coerce(c):b.type.validate(c));if(b.augments&&!(c instanceof b.augments))throw new Error(c+" failed validation.");var d=this[a];return this[a]=c,b.chain?this:d}},l=c.after=function(a,b){return function(){var c=a.apply(this,arguments);return b.call(this),c}},m=c.around=function(a,b){return function(){var c=this,d=Array.prototype.slice.call(arguments),e=function(){return a.apply(c,arguments)};return d.unshift(e),b.apply(c,d)}},n=c.before=function(a,b){return function(){return b.call(this),a.apply(this,arguments)}},o=c.clone=function(a){var b=Object.create(e(a));return b.constructor=a.constructor,h(b,a),b},p=c.construct=function(a,b){return h(a.prototype,b),a},q=c.reader=function(a,b){return b=b||{},b.writer=b.writer||k(a,b),b.predicate=b.predicate||i(a),function(){if(!b.predicate.call(this)){if(b.required)throw new Error(a+" is required.");if(b.devoid){var c=b.devoid;c instanceof Function&&(c=c.call(this)),b.writer.call(this,c)}else b.builder&&b.writer.call(this,this[b.builder].call(this))}return this[a]}};c.Type=p(function(a){a=a||{},"function"==typeof a&&(a={validate:a}),a.validate&&(this._validateMethod=a.validate),a.coerce&&(this._coerceMethod=a.coerce),a.parent&&(this._parent=a.parent)},{check:function(a){return c.Type.validationDisabled?!0:this._parent&&!this._parent.check(a)?!1:this._validateMethod?this._validateMethod(a)?!0:!1:!0},validate:function(a){if(!this.check(a))throw new Error(a+" failed validation.")},coerce:function(a){return a=this.coerceOnly(a),this.validate(a),a},coerceOnly:function(a){return this._parent&&(a=this._parent.coerceOnly(a)),this._coerceMethod&&(a=this._coerceMethod(a)),a},subtype:function(a){return"function"==typeof a&&(a={validate:a}),new c.Type(h({parent:this},a))}}),c.Type.validationDisabled=!1;var r=c.Type,s=c.accessor=function(a,b){return b=b||{},b.writer=b.writer||k(a,b),b.reader=b.reader||q(a,b),function(a){return void 0!==a?b.writer.call(this,a):b.reader.call(this)}},t=c.augment=function(a,b,c){var d=m(a,b);return childProto=Object.create(a.prototype),c&&h(childProto,c),d.prototype=childProto,d},u=(c.disableTypeValidation=function(a){return a?g(r,"validationDisabled",function(){return r.validationDisabled=!0,a()}):void(r.validationDisabled=!0)},c.AllType=t(r,function(a,b,c){c=c||{},c.validate=function(a){for(var c in b)if(!b[c].check(a))return!1;return!0},a(c)})),v=c.AnyType=t(r,function(a,b,c){c=c||{},c.validate=function(a){for(var c=0,d=b.length;d>c;c++)if(b[c].check(a))return!0;return!1},a(c)}),w=c.EnumType=t(r,function(a,b,c){c=c||{},c.validate=function(a){for(var c in b)if(a===b[c])return!0;return!1},a(c)}),x=c.EqualType=t(r,function(a,b,c){c=c||{},c.validate=function(a){return a===b?!0:!1},a(c)}),y=c.InstanceOfType=t(r,function(a,b,c){c=c||{},c.validate=function(a){return a instanceof b?!0:!1},c.coerce=function(a){return this.check(a)?a:new b(a)},a(c)}),z=c.NoneType=t(r,function(a,b,c){c=c||{};var d=new v(b);c.validate=function(a){return d.check(a)?!1:!0},a(c)}),A=c.NotType=t(z,function(a,b,c){a([b],c)}),B=c.TypeOfType=t(r,function(a,b,c){c=c||{},c.validate=function(a){return typeof a===b?!0:!1},a(c)}),C=c.arrayType=new y(Array),D=c.booleanType=new v([new B("boolean"),new y(Boolean)]),E=(c.dateType=new y(Date),c.functionType=new y(Function)),F=c.nullType=new x(null),G=c.numberType=new v([new B("number"),new y(Number)]),H=c.objectType=new y(Object),I=c.positiveType=G.subtype(function(a){return a>0?!0:!1}),J=(c.regExpType=new y(RegExp),c.simpleObjectType=H.subtype(function(a){return a.constructor===Object?!0:!1})),K=c.stringType=new v([new B("string"),new y(String)]),L=c.typeType=new y(r),M=c.undefinedType=new x(void 0),N=c.ArrayOfType=t(r,function(a,b,c){c=c||{},c.validate=function(a){if(!C.check(a))return!1;for(var c in a)if(!b.check(a[c]))return!1;return!0},c.coerce=function(a){if(!this.check(a))return a;for(var c in a)a[c]=b.coerce(a[c]);return a},a(c)}),O=c.DuckType=t(r,function(a,b,c){c=c||{},c.validate=function(a){if(!H.check(a))return!1;if(C.check(b)){for(var c in b)if(void 0===a[b[c]])return!1;return!0}if(J.check(b)){for(var d in b){if(void 0===a[d])return!1;if(!b[d].check(a[d]))return!1}return!0}return!1},a(c)}),P=c.ObjectOfType=t(r,function(a,b,c){c=c||{},c.validate=function(a){if(!H.check(a))return!1;for(var c in a)if(!b.check(a[c]))return!1;return!0},c.coerce=function(a){if(!this.check(a))return a;for(var c in a)a[c]=b.coerce(a[c]);return a},a(c)}),Q=c.PatternType=t(r,function(a,b,c){c=c||{},c.validate=function(a){return K.check(a)?b.test(a):!1},a(c)}),R=(c.TupleType=t(r,function(a,b,c){c=c||{},c.validate=function(a){if(!C.check(a))return!1;if(a.length!=b.length)return!1;for(var c in a){if(!b[c])return!1;if(!b[c].check(a[c]))return!1}return!0},c.coerce=function(a){if(!this.check(a))return a;for(var c in a)b[c]&&(a[c]=b[c].coerce(a[c]));return a},a(c)}),c.definedType=new A(M)),S=c.identifierType=new Q(/^[A-Za-z_$][A-Za-z_$0-9]*$/),T=c.integerType=G.subtype(function(a){return Math.floor(a)===a+0?!0:!1}),U=(c.negativeType=G.subtype(function(a){return 0>a?!0:!1}),c.nonEmptyStringType=K.subtype(function(a){return a.length>0?!0:!1}),c.nonZeroType=G.subtype(function(a){return 0!==a?!0:!1}),c.positiveIntType=new u([T,I]),new v([D,S])),V={key:{type:S,required:!0},argKey:{type:new v([S,F]),devoid:function(){return this.key()}},valueKey:{type:S,devoid:function(){return"_"+this.key()}},devoid:{type:R},builder:{type:U,filter:function(a){return a===!0&&(a="build"+j(this.key())),a}},required:{type:D},type:{type:new v([new w(["undefined","object","boolean","number","string","function"]),L,E])},coerce:{type:D},filter:{type:E},augments:{type:E},chain:{type:D},reader:{type:U,devoid:!0,filter:function(a){return a===!0&&(a=this.key()),a}},writer:{type:U,filter:function(a){return a===!0&&(a=this.key()),a}},predicate:{type:U,filter:function(a){return a===!0&&(a="has"+j(this.key())),a}},clearer:{type:U,filter:function(a){return a===!0&&(a="clear"+j(this.key())),a}},proxies:{type:new P(S)}},W={},X={};for(var Y in V)W[Y]=k("_"+Y,V[Y]),X[Y]=q("_"+Y,h({writer:W[Y]},V[Y]));var Z,$=c.Attribute=p(function(a){if(a=a||{},this._originalArgs=o(a),a.traits){var b=new c.Trait({traits:a.traits});b.install(this,a)}W.key.call(this,a.key);for(var d in a)W[d]&&W[d].call(this,a[d])},h({readerMethod:q("_readerMethod",{type:E,devoid:function(){return q(this.valueKey(),{devoid:this.devoid(),builder:this.builder(),required:this.required(),writer:this.writerMethod(),predicate:this.predicateMethod()})}}),writerMethod:q("_writerMethod",{type:E,devoid:function(){return k(this.valueKey(),{type:this.type(),coerce:this.coerce(),filter:this.filter(),augments:this.augments(),chain:this.chain()})}}),accessorMethod:q("_accessorMethod",{type:E,devoid:function(){return s(this.valueKey(),{writer:this.writerMethod(),reader:this.readerMethod()})}}),predicateMethod:q("_predicateMethod",{type:E,devoid:function(){return i(this.valueKey())}}),clearerMethod:q("_clearerMethod",{type:E,devoid:function(){return d(this.valueKey())}}),proxyMethods:q("_proxyMethods",{type:new P(E),devoid:function(){var a={},b=this.proxies();if(void 0===b)return a;var c=this;for(var d in b)a[d]=function(a){return function(){var b=c.getValue(this);return b[a].apply(b,arguments)}}(b[d]);return a}}),getValue:function(a){return this.readerMethod().call(a)},setValue:function(a,b){return this.writerMethod().call(a,b)},hasValue:function(a){return this.predicateMethod().call(a)},clearValue:function(a){return this.clearerMethod().call(a)},setValueFromArgs:function(a,b){return this.argKey()&&void 0!==b[this.argKey()]?this.setValue(a,b[this.argKey()]):void 0},install:function(a,b){this.writer()&&this.writer()===this.reader()?a[this.writer()]=this.accessorMethod():(this.writer()&&(a[this.writer()]=this.writerMethod()),this.reader()&&(a[this.reader()]=this.readerMethod())),this.predicate()&&(a[this.predicate()]=this.predicateMethod()),this.clearer()&&(a[this.clearer()]=this.clearerMethod());var c=this.proxyMethods();for(var d in c)a[d]=c[d];return b&&this.setValue(a,b),a},rebuild:function(a){var b=this.constructor;return new b(h({},this._originalArgs,a))}},X)),_=c.attributeType=new y($);c.Trait=p(function(a){"function"==typeof a&&(a=this.functionToArgs(a)),a=a||{};for(var b in Z)Z[b].setValueFromArgs(this,a)},{functionToArgs:function(a){var b={requires:[],traits:[],attributes:{},methods:{},around:{},before:{},after:{}},c={require:function(a){b.requires.push(a)},trait:function(a){b.traits.push(a)},attribute:function(a,c){b.attributes[a]=c},method:function(a,c){b.methods[a]=c},around:function(a,c){b.around[a]=c},before:function(a,c){b.before[a]=c},after:function(a,c){b.after[a]=c}};return a.apply(c),b},install:function(a,b){var c,d,e=this.requires();e&&e.validate(a);var f=this.methods();for(d in f)a[d]=f[d];var g=this.traits();for(c in g)g[c].install(a);var h=this.attributes();for(d in h)h[d].install(a);var i=this.around();for(d in i)a[d]=m(a[d],i[d]);var j=this.before();for(d in j)a[d]=n(a[d],j[d]);var k=this.after();for(d in k)a[d]=l(a[d],k[d]);return b&&this.setFromArgs(a,b),a},setFromArgs:function(a,b,c){var d=this.attributes();c||(c={});var e,f;for(f in d)c[f]||d[f].filter()||(d[f].setValueFromArgs(a,b),c[f]=!0);for(f in d)c[f]||d[f].filter()&&(d[f].setValueFromArgs(a,b),c[f]=!0);var g=this.traits();for(e in g)g[e].setFromArgs(a,b,c)},buildType:function(){var a,b,c={},d=this.attributes();for(b in d){var e=d[b];e.reader()&&(c[e.reader()]=E),e.writer()&&(c[e.writer()]=E),e.predicate()&&(c[e.predicate()]=E),e.clearer()&&(c[e.clearer()]=E)}for(b in this.methods())c[b]=E;var f=/^_/m;for(b in c)b.match(f)&&delete c[b];c=new O(c);var g=this.traits();if(!g.length)return c;var h=[c];for(a in g)h.push(g[a].type());return new u(h)}}),Z=[{key:"requires",type:new y(O),coerce:!0},{key:"traits",type:new N(new y(c.Trait)),devoid:function(){return[]}},{key:"attributes",type:new P(_),devoid:function(){return{}},filter:function(a){var b={};for(var c in a){var d=a[c];_.check(d)?d.key()!==c&&(d=d.rebuild({key:c})):d=new $(h({},d,{key:c})),b[c]=d}return b}},{key:"methods",type:new P(E),devoid:function(){return{}}},{key:"around",type:new P(E),devoid:function(){return{}}},{key:"before",type:new P(E),devoid:function(){return{}}},{key:"after",type:new P(E),devoid:function(){return{}}},{key:"type",type:L,builder:!0,argKey:null}];var aa=c.Trait.prototype;for(var ba in Z)Z[ba]=new $(Z[ba]),Z[ba].install(aa);var ca=c.Trait,da=c.traitType=new y(ca),ea=c.classTrait=new ca({attributes:{type:{type:L,builder:!0,argKey:null},trait:{type:da,required:!0}},methods:{buildType:function(){return new y(this)}}}),fa=c.Class=p(function(a){var b=new ca(a),c=function(a){a=a||{},b.setFromArgs(this,a)};return b.install(c.prototype),ea.install(c,{trait:b}),c});c.classType=ea.type().subtype({coerce:function(a){return this.check(a)?a:new fa(a)}});a.o=c,a.oJS=c,c.noConflict=function(){return a.o=b,c}}).call(this);